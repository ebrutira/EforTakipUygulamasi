@section Scripts {
    <script>
        $(document).ready(function() {
            loadCharts();
        });

        function loadCharts() {
            // Request controller'dan veri al
            $.get('/Request/GetAllJson', function(data) {
                if (data && data.length > 0) {
                    createStatusChart(data);
                    createSizeChart(data);
                    createEffortChart(data);
                }
            }).fail(function() {
                console.log('Chart verileri yüklenemedi');
            });
        }

        function createStatusChart(requests) {
            const statusCounts = {
                'New': requests.filter(r => r.status === 1).length,
                'InProgress': requests.filter(r => r.status === 2).length,
                'Testing': requests.filter(r => r.status === 3).length,
                'Completed': requests.filter(r => r.status === 5).length
            };

            const ctx = document.getElementById('statusChart');
            if (ctx) {
                new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Yeni', 'Devam Eden', 'Test', 'Tamamlandı'],
                        datasets: [{
                            data: [statusCounts.New, statusCounts.InProgress, statusCounts.Testing, statusCounts.Completed],
                            backgroundColor: ['#667eea', '#ffc107', '#fd7e14', '#28a745']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    }
                });
            }
        }

        function createSizeChart(requests) {
            // T-Shirt size dağılımı hesapla
            const sizeCounts = {};
            requests.forEach(r => {
                const totalHours = (r.analystHours || 0) + (r.developerHours || 0) + (r.kktHours || 0) + (r.preprodHours || 0);
                const days = totalHours / 8;
                let size = 'FastTrack';
                if (days <= 5) size = 'FastTrack';
                else if (days <= 10) size = 'XS';
                else if (days <= 25) size = 'S';
                else if (days <= 50) size = 'M';
                else if (days <= 100) size = 'L';
                else size = 'XL';

                sizeCounts[size] = (sizeCounts[size] || 0) + 1;
            });

            const ctx = document.getElementById('sizeChart');
            if (ctx) {
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: Object.keys(sizeCounts),
                        datasets: [{
                            label: 'İş Sayısı',
                            data: Object.values(sizeCounts),
                            backgroundColor: ['#28a745', '#28a745', '#ffc107', '#fd7e14', '#dc3545', '#6f42c1']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });
            }
        }

        function createEffortChart(requests) {
            let analystTotal = 0, devTotal = 0, kktTotal = 0, preprodTotal = 0;

            requests.forEach(r => {
                analystTotal += r.analystHours || 0;
                devTotal += r.developerHours || 0;
                kktTotal += r.kktHours || 0;
                preprodTotal += r.preprodHours || 0;
            });

            const ctx = document.getElementById('effortChart');
            if (ctx) {
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Analist', 'Yazılım', 'KKT', 'Preprod'],
                        datasets: [{
                            label: 'Toplam Saat',
                            data: [analystTotal, devTotal, kktTotal, preprodTotal],
                            backgroundColor: ['#667eea', '#28a745', '#ffc107', '#fd7e14']
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });
            }
        }
    </script>
}